<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Σ∞3 Tesla Towers — Generator + Collection + Mint</title>
  <meta name="description" content="Σ∞3 Tesla Towers — NFT generator and live collection hub with 3•6•9 manifesto tracker, image splitter, metadata export, and mint panel." />
  <meta name="theme-color" content="#5b21b6" />
  <meta property="og:title" content="Σ∞3 Tesla Towers — Generator + Collection + Mint" />
  <meta property="og:description" content="Image Splitter • Rarity • Metadata • 3•6•9 • Live Collection • Mint" />
  <meta property="og:type" content="website" />
  <link rel="icon" href="data:," />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .bg-grad {
      background: radial-gradient(1200px 600px at 20% 10%, rgba(91,33,182,.35), transparent 60%),
                 radial-gradient(900px 500px at 80% 0%, rgba(59,130,246,.20), transparent 50%),
                 #0b0b10;
    }
    .glass {
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.06);
    }
    .btn  {
      padding-left: 1rem;
      padding-right: 1rem;
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
      border-radius: 0.375rem;
      font-weight: 500;
    }
    iframe {
      border: none;
      width: 100%;
    }
    @media (prefers-reduced-motion: reduce){ *{scroll-behavior:auto} }
    /* language dropdown styling */
    select.lang {
      background: rgba(255,255,255,.9);
      border-radius: .375rem;
      padding: .35rem .5rem;
      color: #111827;
    }
  </style>
</head>
<body class="text-gray-100 bg-grad antialiased">
  <!-- Navigation -->
  <header class="sticky top-0 z-50 backdrop-blur bg-black/30 border-b border-white/10">
    <nav class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <!-- Logo icon -->
        <svg class="w-7 h-7 text-purple-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <rect x="5" y="3" width="10" height="10" rx="2" transform="rotate(45 5 3)" />
          <rect x="9" y="7" width="10" height="10" rx="2" transform="rotate(45 9 7)" />
        </svg>
        <span id="brandLabel" class="font-bold tracking-wide">Σ∞3 • Tesla Towers</span>
      </div>
      <div class="hidden md:flex gap-6 text-sm">
        <a href="#generator" id="navGenerator" class="hover:text-purple-300">Generator</a>
        <a href="#manifesto" id="nav369" class="hover:text-purple-300">3•6•9</a>
        <a href="#splitter" id="navSplitter" class="hover:text-purple-300">Image Splitter</a>
        <a href="#tesla" id="navCollection" class="hover:text-purple-300">Collection</a>
        <a href="#mint" id="navMint" class="hover:text-purple-300">Mint</a>
        <a href="#export" id="navExport" class="hover:text-purple-300">Export</a>
      </div>
      <!-- Language switcher -->
      <div class="flex items-center gap-2">
        <label for="lang" class="sr-only">Language</label>
        <select id="lang" class="lang" aria-label="Language selector">
          <option value="en">English</option>
          <option value="ro">Română</option>
          <option value="hu">Magyar</option>
        </select>
      </div>
    </nav>
  </header>

  <!-- Hero section -->
  <section id="generator" class="max-w-5xl mx-auto px-4 pt-12 pb-8">
    <h1 id="heroTitle" class="text-3xl md:text-5xl font-extrabold leading-tight">
      NFT Art Generator — <span class="text-purple-400">Tesla Edition</span>
    </h1>
    <p id="heroDesc" class="mt-4 text-gray-300 max-w-3xl">
      Unified dashboard: layer uploads, rarity setup, metadata export and the live <span class="font-semibold">Tesla Towers</span> collection — all on one page.
    </p>
    <div class="mt-6 flex flex-wrap gap-3">
      <a href="#splitter" id="heroBtnSplitter" class="btn bg-purple-600 hover:bg-purple-500">Image Splitter</a>
      <a href="#tesla" id="heroBtnCollection" class="btn border border-purple-500 hover:bg-purple-500/20">Tesla Collection</a>
    </div>
    <div id="heroMintHint" class="mt-4 text-xs text-gray-400">Mint panel at the bottom of the page.</div>
  </section>

  <!-- Manifesto tracker -->
  <section id="manifesto" class="max-w-5xl mx-auto px-4 pb-10">
    <div class="glass rounded-xl p-5">
      <h2 id="manifestoTitle" class="text-xl font-bold mb-2">3•6•9 Tesla Manifesto – daily tracker</h2>
      <p id="mantraLabel" class="text-gray-300 mb-4">Mantra (write yours freely, it’s saved):</p>
      <textarea id="affirm" class="w-full glass rounded p-3 text-sm resize-y" rows="3" placeholder="Today my life changes. My Σ∞3 Tesla Towers project and NFT collection are successful. My energy is focused; abundance and creativity flow to me."></textarea>
      <div class="grid sm:grid-cols-3 gap-4 mt-4">
        <div class="glass rounded p-4">
          <div id="morningLabel" class="text-sm text-gray-400">Morning</div>
          <div class="text-2xl font-bold"><span id="mornCount">0</span>/3</div>
          <button data-key="morn" id="btnMorn" class="btn mt-2 bg-emerald-600 hover:bg-emerald-500 w-full">+1</button>
        </div>
        <div class="glass rounded p-4">
          <div id="noonLabel" class="text-sm text-gray-400">Noon</div>
          <div class="text-2xl font-bold"><span id="noonCount">0</span>/6</div>
          <button data-key="noon" id="btnNoon" class="btn mt-2 bg-blue-600 hover:bg-blue-500 w-full">+1</button>
        </div>
        <div class="glass rounded p-4">
          <div id="eveningLabel" class="text-sm text-gray-400">Evening</div>
          <div class="text-2xl font-bold"><span id="eveCount">0</span>/9</div>
          <button data-key="eve" id="btnEve" class="btn mt-2 bg-purple-600 hover:bg-purple-500 w-full">+1</button>
        </div>
      </div>
      <div class="mt-4 flex items-center justify-between">
        <div id="counterNote" class="text-xs text-gray-400">The counter is saved for today (localStorage). Automatic reset at midnight.</div>
        <button id="resetDay" class="btn border border-white/20 hover:bg-white/10">Daily reset</button>
      </div>
    </div>
  </section>

  <!-- Image Splitter section -->
  <section id="splitter" class="max-w-6xl mx-auto px-4 pb-10">
    <div class="glass rounded-xl p-5">
      <div class="flex items-center justify-between">
        <h2 id="splitterTitle" class="text-xl font-bold">Image Splitter</h2>
        <a id="splitterOpen" class="text-sm text-purple-300 hover:underline" href="https://lorenzooka.github.io/quantum-feather-nexus/perfect_image_splitter.html" target="_blank" rel="noopener">Open separately</a>
      </div>
      <div class="mt-4">
        <iframe id="splitterFrame" title="Image Splitter" style="height:640px"></iframe>
      </div>
      <p id="splitterInfo" class="text-xs text-gray-400 mt-2">If the file isn’t in the repo yet, an info message will appear here.</p>
    </div>
  </section>

  <!-- Tesla collection section -->
  <section id="tesla" class="max-w-6xl mx-auto px-4 pb-12">
    <div class="glass rounded-xl p-5">
      <div class="flex items-center justify-between">
        <h2 id="collectionTitle" class="text-xl font-bold">Tesla Towers — live collection</h2>
        <a id="collectionOpen" class="text-sm text-purple-300 hover:underline" href="https://lorenzooka.github.io/quantum-feather-nexus/tower_collection.html" target="_blank" rel="noopener">Open in new tab</a>
      </div>
      <div class="mt-4">
        <iframe id="teslaFrame" title="Tesla Towers Collection" style="height:900px"></iframe>
      </div>
    </div>
  </section>

  <!-- Mint panel -->
  <section id="mint" class="max-w-5xl mx-auto px-4 pb-10">
    <div class="glass rounded-xl p-6">
      <h2 id="mintTitle" class="text-xl font-bold mb-2">Mint — Σ∞3 Tesla Towers</h2>
      <p id="mintDesc" class="text-gray-300 mb-4">Connect your wallet, set a quantity and mint on Polygon.</p>
      <div class="flex flex-wrap items-center gap-3">
        <button id="connectBtn" class="btn bg-purple-600 hover:bg-purple-500">Connect Wallet</button>
        <span id="addr" class="text-sm text-gray-400"></span>
      </div>
      <div class="mt-4 flex flex-wrap items-center gap-3">
        <label id="qtyLabel" for="qty" class="text-sm text-gray-300">Qty:</label>
        <input id="qty" type="number" min="1" value="1" class="w-24 glass rounded p-2 text-black">
        <button id="mintBtn" disabled class="btn border border-purple-500 hover:bg-purple-500/20">Mint</button>
        <span id="status" class="text-sm text-gray-400"></span>
      </div>
      <div id="networkNote" class="text-xs text-gray-400 mt-2">Network: Polygon (Mainnet or Amoy testnet). Price is read from the contract.</div>
    </div>
  </section>

  <!-- Export & Deploy -->
  <section id="export" class="max-w-5xl mx-auto px-4 pb-16">
    <div class="glass rounded-xl p-6 text-center">
      <h2 id="exportTitle" class="text-xl font-bold mb-2">Export & Deploy</h2>
      <p id="exportDesc" class="text-gray-300 mb-4">Export images + metadata JSON/CSV to IPFS (CID), then set your contract’s tokenURI to those. I can help with scripting if needed.</p>
      <div class="flex flex-wrap gap-3 justify-center">
        <a id="exportJsonBtn" href="metadata_batch_3tiers_json.zip" class="btn border border-purple-500 hover:bg-purple-500/20">JSON (sample)</a>
        <a id="exportCsvBtn" href="tesla_towers_batch_3tiers.csv" class="btn border border-purple-500 hover:bg-purple-500/20">CSV (sample)</a>
        <a id="exportRevealBtn" href="tower_sequence_sample.csv" class="btn border border-purple-500 hover:bg-purple-500/20">Reveal order (sample)</a>
      </div>
    </div>
  </section>

  <footer class="text-center text-xs text-gray-500 pb-10" id="footerText">© Σ∞3 Tesla Towers</footer>

  <!-- Ethers.js for mint panel (v6) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <!-- Main script: translations, iframes, manifesto tracker, and mint logic -->
  <script>
    // ********* LANGUAGE TRANSLATIONS *********
    const translations = {
      en: {
        nav: { generator: 'Generator', t369: '3•6•9', splitter: 'Image Splitter', collection: 'Collection', mint: 'Mint', export: 'Export' },
        heroTitle: 'NFT Art Generator — <span class="text-purple-400">Tesla Edition</span>',
        heroDesc: 'Unified dashboard: layer uploads, rarity setup, metadata export and the live <span class="font-semibold">Tesla Towers</span> collection — all on one page.',
        heroBtnSplitter: 'Image Splitter',
        heroBtnCollection: 'Tesla Collection',
        heroMintHint: 'Mint panel at the bottom of the page.',
        manifestoTitle: '3•6•9 Tesla Manifesto – daily tracker',
        mantraLabel: 'Mantra (write yours freely, it’s saved):',
        affirmPlaceholder: 'Today my life changes. My Σ∞3 Tesla Towers project and NFT collection are successful. My energy is focused; abundance and creativity flow to me.',
        morning: 'Morning', noon: 'Noon', evening: 'Evening',
        plusOne: '+1', dailyReset: 'Daily reset', counterNote: 'The counter is saved for today (localStorage). Automatic reset at midnight.',
        splitterTitle: 'Image Splitter', splitterOpen: 'Open separately', splitterInfo: 'If the file isn’t in the repo yet, an info message will appear here.',
        collectionTitle: 'Tesla Towers — live collection', collectionOpen: 'Open in new tab',
        mintTitle: 'Mint — Σ∞3 Tesla Towers', mintDesc: 'Connect your wallet, set a quantity and mint on Polygon.', connectWallet: 'Connect Wallet', qty: 'Qty:', mint: 'Mint', networkNote: 'Network: Polygon (Mainnet or Amoy testnet). Price is read from the contract.',
        exportTitle: 'Export & Deploy', exportDesc: 'Export images + metadata JSON/CSV to IPFS (CID), then set your contract’s tokenURI to those. I can help with scripting if needed.', jsonSample: 'JSON (sample)', csvSample: 'CSV (sample)', revealSample: 'Reveal order (sample)',
        footer: '© Σ∞3 Tesla Towers', fallbackCard: 'We couldn’t find this tool locally or remotely yet. Open the link above, or add the file to the repository.'
      },
      ro: {
        nav: { generator: 'Generator', t369: '3•6•9', splitter: 'Image Splitter', collection: 'Colecție', mint: 'Mint', export: 'Export' },
        heroTitle: 'Generator NFT — <span class="text-purple-400">Ediția Tesla</span>',
        heroDesc: 'Panou unificat: încărcare straturi, setare raritate, export de metadata și colecția <span class="font-semibold">Tesla Towers</span> live — toate într-o singură pagină.',
        heroBtnSplitter: 'Image Splitter',
        heroBtnCollection: 'Colecția Tesla',
        heroMintHint: 'Panoul de mint este la finalul paginii.',
        manifestoTitle: 'Manifestul Tesla 3•6•9 – urmărire zilnică',
        mantraLabel: 'Mantră (scrie liber, se salvează):',
        affirmPlaceholder: 'Astăzi viața mea se schimbă. Proiectul meu Σ∞3 Tesla Towers și colecția mea NFT au succes. Energia mea este concentrată; abundența și creativitatea curg către mine.',
        morning: 'Dimineața', noon: 'Prânz', evening: 'Seara',
        plusOne: '+1', dailyReset: 'Reset zilnic', counterNote: 'Contorul este salvat pentru azi (localStorage). Reset automat la miezul nopții.',
        splitterTitle: 'Image Splitter', splitterOpen: 'Deschide separat', splitterInfo: 'Dacă fișierul nu e încă în repo, aici apare un mesaj informativ.',
        collectionTitle: 'Tesla Towers — colecție live', collectionOpen: 'Deschide într-o filă nouă',
        mintTitle: 'Mint — Σ∞3 Tesla Towers', mintDesc: 'Conectează portofelul, alege cantitatea și mintează pe Polygon.', connectWallet: 'Conectează portofelul', qty: 'Cantitate:', mint: 'Mint', networkNote: 'Rețea: Polygon (Mainnet sau testnet Amoy). Prețul este citit din contract.',
        exportTitle: 'Exportă & Publică', exportDesc: 'Exportă imaginile + metadata JSON/CSV pe IPFS (CID), apoi setează tokenURI-ul contractului către acestea. Te pot ajuta cu scriptingul.', jsonSample: 'JSON (exemplu)', csvSample: 'CSV (exemplu)', revealSample: 'Ordine de reveal (exemplu)',
        footer: '© Σ∞3 Tesla Towers', fallbackCard: 'Nu am găsit încă acest instrument local sau remote. Deschide linkul de mai sus sau adaugă fișierul în repository.'
      },
      hu: {
        nav: { generator: 'Generátor', t369: '3•6•9', splitter: 'Image Splitter', collection: 'Kollekció', mint: 'Mint', export: 'Export' },
        heroTitle: 'NFT Art Generátor — <span class="text-purple-400">Tesla Kiadás</span>',
        heroDesc: 'Egyesített dashboard: rétegfeltöltés, ritkaság beállítás, metadata export és az élő <span class="font-semibold">Tesla Towers</span> kollekció — mind egy oldalon.',
        heroBtnSplitter: 'Image Splitter',
        heroBtnCollection: 'Tesla kollekció',
        heroMintHint: 'Mint panel az oldal alján.',
        manifestoTitle: '3•6•9 Tesla Manifesto – napi tracker',
        mantraLabel: 'Mantra (írj bele bátran, ez mentésre kerül):',
        affirmPlaceholder: 'Ma megváltozik az életem. A Σ∞3 Tesla Towers projektem és az NFT kollekcióm sikeres. Energiám fókuszált; bőség és kreativitás áramlik felém.',
        morning: 'Reggel', noon: 'Dél', evening: 'Este',
        plusOne: '+1', dailyReset: 'Napi reset', counterNote: 'A számláló a mai napra mentve (localStorage). Éjfélkor automatikus reset.',
        splitterTitle: 'Image Splitter', splitterOpen: 'Megnyitás külön', splitterInfo: 'Ha a fájl még nincs a repóban, itt infó‑üzenet jelenik meg.',
        collectionTitle: 'Tesla Towers — élő kollekció', collectionOpen: 'Megnyitás új lapon',
        mintTitle: 'Mint — Σ∞3 Tesla Towers', mintDesc: 'Csatlakoztasd a tárcádat, állítsd be a mennyiséget és mintelj a Polygonon.', connectWallet: 'Tárca csatlakoztatása', qty: 'Mennyiség:', mint: 'Mint', networkNote: 'Hálózat: Polygon (főhálózat vagy Amoy teszthálózat). Az ár a szerződésből kerül beolvasásra.',
        exportTitle: 'Export & Deploy', exportDesc: 'Exportáld a képeket + metadata JSON/CSV‑t IPFS‑re (CID), majd a szerződés tokenURI‑ját állítsd ezekre. Szükség esetén segítek a scripteléssel.', jsonSample: 'JSON (minta)', csvSample: 'CSV (minta)', revealSample: 'Reveal sorrend (minta)',
        footer: '© Σ∞3 Tesla Towers', fallbackCard: 'Ezt az eszközt még nem találtuk meg sem helyben, sem távolról. Nyisd meg a fenti linket vagy add hozzá a fájlt a repóhoz.'
      }
    };

    // Apply translations based on selected language
    function applyLang(lang) {
      const t = translations[lang] || translations.en;
      document.getElementById('navGenerator').textContent = t.nav.generator;
      document.getElementById('nav369').textContent      = t.nav.t369;
      document.getElementById('navSplitter').textContent  = t.nav.splitter;
      document.getElementById('navCollection').textContent= t.nav.collection;
      document.getElementById('navMint').textContent      = t.nav.mint;
      document.getElementById('navExport').textContent    = t.nav.export;
      document.getElementById('heroTitle').innerHTML      = t.heroTitle;
      document.getElementById('heroDesc').innerHTML       = t.heroDesc;
      document.getElementById('heroBtnSplitter').textContent = t.heroBtnSplitter;
      document.getElementById('heroBtnCollection').textContent = t.heroBtnCollection;
      document.getElementById('heroMintHint').textContent = t.heroMintHint;
      document.getElementById('manifestoTitle').textContent = t.manifestoTitle;
      document.getElementById('mantraLabel').textContent   = t.mantraLabel;
      document.getElementById('affirm').placeholder        = t.affirmPlaceholder;
      document.getElementById('morningLabel').textContent  = t.morning;
      document.getElementById('noonLabel').textContent     = t.noon;
      document.getElementById('eveningLabel').textContent  = t.evening;
      document.getElementById('btnMorn').textContent       = t.plusOne;
      document.getElementById('btnNoon').textContent       = t.plusOne;
      document.getElementById('btnEve').textContent        = t.plusOne;
      document.getElementById('resetDay').textContent      = t.dailyReset;
      document.getElementById('counterNote').textContent   = t.counterNote;
      document.getElementById('splitterTitle').textContent = t.splitterTitle;
      document.getElementById('splitterOpen').textContent  = t.splitterOpen;
      document.getElementById('splitterInfo').textContent  = t.splitterInfo;
      document.getElementById('collectionTitle').textContent = t.collectionTitle;
      document.getElementById('collectionOpen').textContent = t.collectionOpen;
      document.getElementById('mintTitle').textContent      = t.mintTitle;
      document.getElementById('mintDesc').textContent       = t.mintDesc;
      document.getElementById('connectBtn').textContent     = t.connectWallet;
      document.getElementById('qtyLabel').textContent       = t.qty;
      document.getElementById('mintBtn').textContent        = t.mint;
      document.getElementById('networkNote').textContent    = t.networkNote;
      document.getElementById('exportTitle').textContent    = t.exportTitle;
      document.getElementById('exportDesc').textContent     = t.exportDesc;
      document.getElementById('exportJsonBtn').textContent  = t.jsonSample;
      document.getElementById('exportCsvBtn').textContent   = t.csvSample;
      document.getElementById('exportRevealBtn').textContent= t.revealSample;
      document.getElementById('footerText').textContent     = t.footer;
      localStorage.setItem('lang', lang);
      document.documentElement.lang = lang;
    }

    // Initialize language on page load
    (function() {
      const langSelect = document.getElementById('lang');
      const savedLang = localStorage.getItem('lang') || 'en';
      langSelect.value = savedLang;
      applyLang(savedLang);
      langSelect.addEventListener('change', () => {
        applyLang(langSelect.value);
      });
    })();

    // ********* IFRAME AUTO-HEIGHT AND FALLBACK *********
    const REMOTE_BASE = 'https://lorenzooka.github.io/quantum-feather-nexus/';
    const PATHS = {
      splitterLocal: 'perfect_image_splitter.html',
      splitterRemote: REMOTE_BASE + 'perfect_image_splitter.html',
      collectionLocal: 'tower_collection.html',
      collectionRemote: REMOTE_BASE + 'tower_collection.html'
    };
    async function exists(url) {
      try {
        const res = await fetch(url, { cache: 'no-store' });
        return res.ok;
      } catch {
        return false;
      }
    }
    function fallbackCard(msg) {
      const card = document.createElement('div');
      card.className = 'glass rounded p-4 text-sm text-gray-300';
      card.textContent = msg;
      return card;
    }
    async function mountIframe(iframeId, localUrl, remoteUrl, fallbackMsg) {
      const frame = document.getElementById(iframeId);
      let src = null;
      if (await exists(remoteUrl)) {
        src = remoteUrl;
      } else if (await exists(localUrl)) {
        src = localUrl;
      }
      if (src) {
        frame.src = src;
        frame.addEventListener('load', () => autoHeight(frame));
      } else {
        frame.replaceWith(fallbackCard(fallbackMsg));
      }
    }
    function autoHeight(iframe) {
      try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        if (!doc) return;
        const h = Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight);
        iframe.style.height = Math.min(Math.max(h, 600), 3000) + 'px';
      } catch (e) {
        // cross-origin fallback: keep default height
      }
    }
    (async function() {
      const lang = localStorage.getItem('lang') || 'en';
      const fallbackMsg = translations[lang].fallbackCard;
      await mountIframe('splitterFrame', PATHS.splitterLocal, PATHS.splitterRemote, fallbackMsg);
      await mountIframe('teslaFrame', PATHS.collectionLocal, PATHS.collectionRemote, fallbackMsg);
    })();

    // ********* 3•6•9 MANIFESTO TRACKER *********
    (function() {
      const affirm = document.getElementById('affirm');
      const morn = document.getElementById('mornCount');
      const noon = document.getElementById('noonCount');
      const eve  = document.getElementById('eveCount');
      const resetBtn = document.getElementById('resetDay');
      function getTodayKey() {
        const d = new Date();
        return `369_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      }
      const todayKey = getTodayKey();
      function load() {
        const data = JSON.parse(localStorage.getItem(todayKey) || '{"m":0,"n":0,"e":0,"a":""}');
        morn.textContent = data.m || 0;
        noon.textContent = data.n || 0;
        eve.textContent  = data.e || 0;
        if (data.a) affirm.value = data.a;
      }
      function save() {
        const obj = { m: +morn.textContent, n: +noon.textContent, e: +eve.textContent, a: affirm.value };
        localStorage.setItem(todayKey, JSON.stringify(obj));
      }
      function inc(which) {
        const el = which === 'morn' ? morn : which === 'noon' ? noon : eve;
        const max = which === 'morn' ? 3 : which === 'noon' ? 6 : 9;
        const v = Math.min(+el.textContent + 1, max);
        el.textContent = v;
        save();
      }
      document.querySelectorAll('button[data-key]').forEach(btn => {
        btn.addEventListener('click', () => inc(btn.dataset.key));
      });
      resetBtn.addEventListener('click', () => {
        localStorage.removeItem(todayKey);
        load();
      });
      affirm.addEventListener('input', save);
      load();
    })();

    // ********* MINT PANEL *********
    (async function() {
      const TARGETS = {
        mainnet: { chainId: '0x89', name: 'Polygon Mainnet' },
        amoy:    { chainId: '0x13882', name: 'Polygon Amoy Testnet' }
      };
      const CONTRACT_ADDR = '0x6babee238e104ae9e83bef73c5f576b4de7e3775';
      const ABI = [
        'function mint(uint256 qty) payable',
        'function mintOpen() view returns (bool)',
        'function mintPrice() view returns (uint256)'
      ];
      const connectBtn = document.getElementById('connectBtn');
      const mintBtn    = document.getElementById('mintBtn');
      const qtyEl      = document.getElementById('qty');
      const addrEl     = document.getElementById('addr');
      const statusEl   = document.getElementById('status');
      let provider, signer, contract;
      async function ensureNetwork() {
        if (!window.ethereum) return null;
        const current = await window.ethereum.request({ method: 'eth_chainId' });
        if (current !== TARGETS.mainnet.chainId && current !== TARGETS.amoy.chainId) {
          try {
            await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: TARGETS.amoy.chainId }] });
            return TARGETS.amoy.name;
          } catch (e) {
            statusEl.textContent = 'Please switch to Polygon (Amoy or Mainnet) in your wallet.';
            throw e;
          }
        }
        return current === TARGETS.mainnet.chainId ? TARGETS.mainnet.name : TARGETS.amoy.name;
      }
      async function connect() {
        if (!window.ethereum) {
          statusEl.textContent = 'No wallet found.';
          return;
        }
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send('eth_requestAccounts', []);
        signer = await provider.getSigner();
        const netName = await ensureNetwork();
        const addr    = await signer.getAddress();
        addrEl.textContent = addr.slice(0, 6) + '…' + addr.slice(-4) + ' — ' + netName;
        contract = new ethers.Contract(CONTRACT_ADDR, ABI, signer);
        try {
          const isOpen = await contract.mintOpen();
          mintBtn.disabled = !isOpen;
          statusEl.textContent = isOpen ? 'Mint is open.' : 'Mint is closed.';
        } catch (e) {
          statusEl.textContent = 'Contract not reachable yet.';
        }
      }
      async function mint() {
        try {
          const qty = Math.max(1, parseInt(qtyEl.value || '1', 10));
          const price = await contract.mintPrice();
          const total = price * BigInt(qty);
          const tx = await contract.mint(qty, { value: total });
          statusEl.textContent = 'Pending… ' + tx.hash;
          const rec = await tx.wait();
          statusEl.textContent = 'Minted! Block ' + rec.blockNumber;
        } catch (e) {
          statusEl.textContent = e?.reason || e?.message || 'Mint failed.';
        }
      }
      connectBtn.addEventListener('click', connect);
      mintBtn.addEventListener('click', mint);
    })();
  </script>
</body>
</html>